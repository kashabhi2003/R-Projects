# Setting lambda as rate parameter, set variables for 1000 simulations and 40 exponentials to investigate 
lambda <- 0.2
num_sim <- 1000
exp_invest <- 40

# Generate 40,000 exponentials and transfer to a Data frame
sim_exp  <- data.frame( x = rexp(num_sim * exp_invest, lambda))

# Create a 1000 by 40 matrix of exponentials
sim_mat <- matrix(sim_exp$x, num_sim)

# Create a vector to store Average of rows of sim_mat / vector has distribution of averages of 40 exponentials
avg_sim_mat_byrow <- rowMeans(sim_mat[, 1:exp_invest])

# Calculate Sample mean and Theorectical mean
samp_mean <- mean(avg_sim_mat_byrow)
theor_mean <- 1/lambda

# Compare Sample mean and Theoretical mean
samp_mean
theor_mean

# Compare Sample mean and Theoretical mean via Histogram plot
hist(avg_sim_mat_byrow,  freq=TRUE, breaks=30,
     main="Sample Mean vs Theoretical Mean",
     xlab="Averages of Exponentials",
     ylab="Density of Averages",
     col='light blue')
abline(v=1/lambda,col='red',lwd=6)     # Theoretical mean in Red
abline(v=samp_mean,col='green',lwd=6)  # Theoretical mean in Green




# Calculate Sample variance and Theorectical variance
samp_var <- var(avg_sim_mat_byrow)
theor_var <- (1/lambda)^2/exp_invest
samp_var
theor_var

# Compare Sample variance and Theoretical variance via bar chart
var_diff <- c(samp_var, theor_var)
barplot(var_diff, main="Sample var vs Theoretical var", 
  	xlab="variance",names.arg=c("Sample var", "Theoretical var"),col=c("darkblue","red"),space = 3)



# Visually compare the actual distribution with Normal distribution

hist(avg_sim_mat_byrow,  prob=T,breaks=40,
     main="Actual distribution vs Normal distribution",
     xlab="Averages of exponentials",
     ylab="Density of Averages",
     col='yellow')

# Density of the means of sample exponentials
lines(density(avg_sim_mat_byrow),col="blue", lty=1, lwd =3)

# Theoretical Mean
abline(v=mean(avg_sim_mat_byrow), col='red',lty=1,lwd=6)

# Sample Mean
abline(v=samp_mean,col='blue',lty=1, lwd=3)

# Normal theoretical density of the exponential distribution
xfit <- seq(min(avg_sim_mat_byrow), max(avg_sim_mat_byrow), length=100)
yfit <- dnorm(xfit, mean=1/lambda, sd=(1/lambda/sqrt(exp_invest)))
lines(xfit, yfit, col="red", lty=1, lwd =3)


legend('topright', c("Sample", "Theoretical"), 
       col=c("black", "red"), lty=c(1,1))


